#!/bin/bash

release_mode="safe"

new_args=()
for arg in "$@"; do
    if [ "$arg" = "--small" ]; then
        release_mode="small"
    elif [ "$arg" = "--fast" ]; then
        release_mode="fast"
    elif [ "$arg" = "--safe" ]; then
        release_mode="safe"
    else
        new_args+=("$arg")
    fi
done

bin/compile "${new_args[@]}"

modified_args=()
for arg in "${new_args[@]}"; do
    if [[ $arg =~ \.[^.]+$ ]]; then
        modified_args+=("${arg%.*}.crbn")
    else
        modified_args+=("$arg")
    fi
done

zig build --release=$release_mode run -- "${modified_args[@]}"
